{% extends 'base_map.html' %}

{% load sekizai_tags humanize %}

{% block page_title %}Soggetto: {{ soggetto }}{% endblock %}
{% block page_description %}Informazioni sui progetti in cui partecipa {{ soggetto }}{% endblock %}

{% block layer-selector %}
    <div id="map-layer-selector" class="{% block selector-span %}span8{% endblock %} block-container">
        <a href="{{ request.path }}?tematizzazione=totale_costi" class="block-chart block-chart-soggetto{% if tematizzazione == 'totale_costi' %} block-active{% endif %}" data-dataset="totale_costi">
            <strong class="title">Finanziamenti monitorati</strong>
            <p>{{ totale_costi|intword }} <span>di euro</span></p>
            {% if tematizzazione == 'totale_costi' %}<div class="caret"></div>{% else %}<i class="icon-undo"></i>{% endif %}
        </a>

        <a href="{{ request.path }}?tematizzazione=totale_pagamenti" class="block-chart block-chart-soggetto{% if tematizzazione == 'totale_pagamenti' %} block-active{% endif %}" title="{{ percentuale_costi_pagamenti }} del totale" data-dataset="totale_pagamenti">
            <strong class="title">Pagamenti monitorati</strong>
            <p>{{ totale_pagamenti|intword }} <span>di euro</span></p>
            {% if tematizzazione == 'totale_pagamenti' %}<div class="caret"></div>{% else %}<i class="icon-undo"></i>{% endif %}
        </a>

        <a href="{{ request.path }}?tematizzazione=totale_progetti" class="block-chart block-chart-soggetto{% if tematizzazione == 'totale_progetti' %} block-active{% endif %}" data-dataset="totale_progetti">
            <strong class="title">Progetti monitorati</strong>
            <p>{{ totale_progetti|intcomma }}</p>
            {% if tematizzazione == 'totale_progetti' %}<div class="caret"></div>{% else %}<i class="icon-undo"></i>{% endif %}
        </a>

       <a href="{{ request.path }}?tematizzazione=anagrafica" class="block-chart block-chart-soggetto{% if tematizzazione == 'anagrafica' %} block-active{% endif %}" style="width:24%" id="button_anagrafica_indicatori">
            <strong class="title">Anagrafica e Altri Dettagli</strong>
            {% if tematizzazione == 'anagrafica' %}<div class="caret"></div>{% else %}<i class="icon-undo"></i>{% endif %}
        </a>
    </div>
{% endblock %}

{% block top_content %}
    <div id="claim-container" class="span4">
        <p class="claim">Al soggetto è associato l'intero finanziamento dei progetti in cui è coinvolto, anche quando i progetti coinvolgono più soggetti.</p>
    </div>
{% endblock %}

{% block page_header %}
    <div class="span12">
        <h1 class="title violet"><span>{{ soggetto }}</span></h1>
        <p style="padding: 0 25px">
            <span class="icon-align-justify"> <a href="{% url 'progetti_search' %}?q=&soggetto={{ soggetto.slug }}">Tutti i progetti</a></span>
        </p>

        <ul class="unstyled">
            {% if soggetto.forma_giuridica %}<li>{{ soggetto.forma_giuridica }}</li>{% endif %}
            {% if soggetto.indirizzo %}<li>{{ soggetto.indirizzo }}</li>{% endif %}
            {% if soggetto.territorio %}<li>{% if soggetto.cap %}{{ soggetto.cap }}{% endif %} {{ soggetto.territorio }}</li>{% endif %}
            {% if soggetto.rappresentante_legale %}<li>Rappresentante legale: {{ soggetto.rappresentante_legale }}</li>{% endif %}
            {% if soggetto.codice_fiscale.strip %}<li>CF.: {{ soggetto.codice_fiscale }}</li>{% endif %}
        </ul>
    </div>
{% endblock %}

{% block container %}
    {{ block.super }}

    {% include 'soggetti/includes/soggetto_detail_bottomboxes.html' %}
{% endblock %}

{% block map %}
    <div class="row">
        <div class="span3">
            <h4>Territori</h4>

            <p>In quali luoghi si interviene?</p>

            <div id="regions_chart" style="width: 100%; height: 250px"></div>

            <table id="regions_chart_table" class="table">
                {% for regione, totale in lista_finanziamenti_per_regione %}
                    {% if totale > 0  %}
                        <tr>
                            <th>{% if regione.cod_reg %}<a href="{% url 'progetti_search' %}?q=&soggetto={{ soggetto.slug }}&territorio_reg={{ regione.cod_reg }}">{{ regione }}</a>{% else %}{{ regione }}{% endif %}</th>
                            <td class="amount"><strong>{{ totale|default:'0'|floatformat:'0' }}</strong></td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </table>
        </div>

        <div class="span3">
            <h4>Finanziamenti per ruolo</h4>

            <p>Che ruolo ha nei progetti?</p>

            <div id="roles_chart" style="width: 100%; height: 250px"></div>

            <table id="roles_chart_table" class="table">
                {% for ruolo, finanziamento in lista_finanziamenti_per_ruolo %}
                    <tr>
                        <th>{{ ruolo }}</th>
                        <td class="amount"><strong>{{ finanziamento|default:'0'|floatformat:'0' }}</strong></td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    {% add_data 'js-data' 'js/highcharts.js' %}
    {% add_data 'js-data' 'js/oc-charts-pie.js' %}
    {% addtoblock 'js' strip %}
        <script>
            $(document).ready(function() {
                print_pie_chart('#regions_chart_table', 'regions_chart');
                print_pie_chart('#roles_chart_table', 'roles_chart');
            });
        </script>
    {% endaddtoblock %}
{% endblock %}
