{% extends 'base_two_columns.html' %}
{% load highlight %}
{% load i18n %}
{% load utils %}

{% block page_title %}Elenco progetti {% endblock page_title %}
{% block page_description %}Elenco dei progetti, navigabile a faccette, con possibilit√† di ricerca testuale.{% endblock page_description %}


{% block content %}
    {% if selected_facets %}
        <ul class="breadcrumb">
            {% for facet in selected_facets  %}
                <li>
                    <a href="{{ facet.url }}"><i class="icon-remove">X</i></a>
                    <span style="color:gray;">{% trans facet.field %}</span>:
                    {{ facet.r_label }}
                </li>
                {% if not forloop.last %}
                    <span class="divider">/</span>
                {% endif %}
            {% endfor %}
        </ul>
    {% else %}
      <p>Puoi trovare il progetto scorrendo la lista degli ultimi pubblicati, qui sotto.
        Puoi perfezionare la ricerca usando i filtri nella colonna qui a destra, oppure puoi usare il form di
        ricerca con una parola che pensi sia contenuta nel progetto ,
        in cima alla colonna qui a destra</p>
    {% endif %}


    {% if n_results %}
      {% autopaginate page.object_list %}

      {% paginate %}

      <section>
        <h3>{% if not query %}Tutti i {% endif %} {{ n_results }} risultati</h3>

        <table class="search-results">
          <tbody>
          {% for result in page.object_list %}
          <tr>
            <td>{{ result.rendered|safe }}</td>
          </tr>
          {% empty %}
              <p>Nessun risultato trovato.</p>
          {% endfor %}
          </tbody>
        </table>
      </section>

      {% paginate %}

    {% else %}
        {# Show some example queries to run, maybe query syntax, something else? #}
    {% endif %}

{% endblock %}

{% block sidebar %}
  <h4>Cerca negli atti</h4>
  <form method="get" action="{% url progetti_search %}" class="form-search">
    <input type="text" class="input-medium search-query" name="{{ form.q.html_name }}" value="{% if form.q.value %}{{ form.q.value }}{% endif %}" placeholder="Testo della ricerca" />
    <button type="submit" class="btn">Cerca</button>
  </form>

    {% if n_results %}
        <!-- Begin faceting. -->
        <h3>Filtra</h3>
        <div>
            <dl>
                {% if facets.fields.natura and not facets.fields.natura.is_field_selected %}
                    <dt>Tipo operazione</dt>
                    {% for t in facets.fields.natura.counts %}
                        {% if t.1 %}
                            <dd>
                                {% if not t.2 %}
                                    <a href="{{ base_url }}&selected_facets=natura:{{ t.0|urlencode }}"
                                       title="{{ natura.descrizione|key:t.0 }}">{{ natura.short_label|key:t.0 }}</a> ({{ t.1 }})
                                {% endif %}
                            </dd>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </dl>
            <dl>
                {% if facets.fields.tema and not facets.fields.tema.is_field_selected %}
                    <dt>Tema</dt>
                    {% for t in facets.fields.tema.counts %}
                        {% if t.1 %}
                            <dd>
                                {% if not t.2 %}
                                    <a href="{{ base_url }}&selected_facets=tema:{{ t.0|urlencode }}"
                                       title="{{ tema.descrizione|key:t.0 }}">{{ tema.short_label|key:t.0 }}</a> ({{ t.1 }})
                                {% endif %}
                            </dd>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </dl>
        </div>
        <!-- End faceting -->
    {% endif %}
{% endblock %}