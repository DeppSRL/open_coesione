{% extends 'base_map.html' %}
{% load humanize %}
{% load sekizai_tags %}
{% load template_functions %}

{% block page_title %}{{ territorio.nome }}{% endblock %}

{% block js_content %}
  {% addtoblock "js_script" %}
{#    <script type="text/javascript" src="{{ STATIC_URL }}js/highcharts.src.js"></script>#}
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap-collapse.js"></script>
{#    <script type="text/javascript" src="{{ STATIC_URL }}js/charts.js"></script>#}
  {% endaddtoblock %}

  {{ block.super }}

  <script type="text/javascript">

    $(document).ready(function() {

        APP.base_url = '{{ STATIC_URL }}' ;

//        print_pie_chart('#main_topics', 'main_topics_chart' );
//        print_pie_chart('#main_types', 'main_types_chart' );

        $('#index_charts .collapse')
            .on('show', function(e) {
                !$.isEmptyObject(APP.chart) && APP.chart.destroy();
                var $chart_container = $(e.currentTarget).css('height','auto');
                var $selectors = $('#topic_chart').next('form');
                //console.log($chart_container,'topic', $chart_container.data('topic'), 'location', $chart_container.data('location') );
                $('#topic_chart')
                    .data('topic', $chart_container.data('topic'))
                    .data('location', $chart_container.data('location'))
                    .appendTo( $chart_container.children().first() )
                    .after( $selectors )
                ;
            })
            .on('shown', function(e) {

                print_line_chart('#topic_chart');

        }).first().collapse('show');

    });
  </script>
{% endblock %}

{% block top_content %}{% endblock %}

{% block container %}

  {{ block.super }}

{#  <div class="container">#}
{##}
{#    <div class="row">#}
{##}
{#      <div class="span6 block-container">#}
{##}
{#        <div class="block-chart block-active">#}
{##}
{#          <strong class="title">Finanziamento pubblico totale dei progetti monitorati*</strong>#}
{#          <p>{{ total_cost|intword }} <span>di euro</span></p>#}
{#          <div class="bar-vertical"></div>#}
{##}
{#        </div>#}
{##}
{#        <div class="block-chart" title="{{ cost_payments_ratio }} del totale">#}
{##}
{#          <strong class="title">Pagamenti effettuati per i progetti monitorati*</strong>#}
{#          <p>{{ total_cost_paid|intword }} <span>di euro</span></p>#}
{#          <div class="bar-vertical" ><span style="height:{{ cost_payments_ratio }}"></span></div>#}
{##}
{#        </div>#}
{##}
{#        <div class="block-chart">#}
{##}
{#          <strong class="title">Numero dei progetti monitorati*</strong>#}
{#          <p>{{ total_projects|intcomma }}</p>#}
{##}
{#        </div>#}
{##}
{#      </div>#}
{#    </div>#}
{##}
{#  </div>#}
{##}
{#  <div class="area">#}
{#    <div class="container">#}
{##}
{#      <div class="row" id="statistics">#}
{##}
{#        <div class="span6">#}
{##}
{#          <h1 class="title"><span>{{ territorio }}</span></h1>#}
{##}
{#          <div class="row">#}
{#            <div class="span3">#}
{#              <h5>Tipologie</h5>#}
{##}
{#              <p>Le tipologie di progetti e gli importi ad esse dedicati.</p>#}
{#            </div>#}
{##}
{#            <div class="span3">#}
{#              <h5>Temi</h5>#}
{##}
{#              <p>Le tematiche che riguardano i progetti e gli importi ad esse dedicati.</p>#}
{#            </div>#}
{#          </div>#}
{##}
{#          <div class="row">#}
{#            <div class="span3">#}
{#              <div id="main_types_chart" style="width: 100%; height: 200px"></div>#}
{##}
{#              <table id="main_types" class="table table-bordered">#}
{#                {% for tipologia in tipologie_principali %}#}
{#                  <tr>#}
{#                    <td><a href="{{ tipologia.get_absolute_url }}">{{ tipologia.descrizione }}</a></td>#}
{#                    <td class="amount"><strong>{{ tipologia|args:territorio|call:'costo_totale'|intcomma }}</strong> euro</td>#}
{#                  </tr>#}
{#                {% endfor %}#}
{#              </table>#}
{#            </div>#}
{##}
{#            <div class="span3">#}
{##}
{##}
{#              <div id="main_topics_chart" style="width: 100%; height: 200px"></div>#}
{##}
{#              <table id="main_topics" class="table table-bordered">#}
{#                {% for tema in temi_principali %}#}
{#                  <tr>#}
{#                    <td><a href="{{ tipologia.get_absolute_url }}">{{ tema.descrizione }}</a></td>#}
{#                    <td class="amount"><strong>{{ tema|args:territorio|call:'costo_totale'|intcomma }}</strong> euro</td>#}
{#                  </tr>#}
{#                {% endfor %}#}
{#              </table>#}
{#            </div>#}
{#          </div>#}
{##}
{#        </div>#}
{##}
{#        <div class="span6">#}
{##}
{#          {% include 'commons/map.html' %}#}
{##}
{#        </div>#}
{#      </div>#}
{##}
{#    </div>#}
{#  </div>#}

  {% if territorio.territorio == 'R' %}
  <section class="container">
    <div class="row">
      <div class="span12" id="charts_accordion">
        <h1>Indicatori sui temi</h1>

        <div class="accordion" id="index_charts">
          {% for tema in temi_principali %}
            <div class="accordion-group">
              <div class="accordion-heading">
                <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#index_charts" data-target="#theme_index_{{ tema.codice }}">

                    <i class="icon-circle-arrow-down pull-right"></i>
                    {{ tema.descrizione }}

                </h2>
              </div>
              <div id="theme_index_{{ tema.codice }}" data-topic="{{ tema.codice }}" data-location="{{ territorio.cod_reg }}" class="accordion-body collapse{% if forloop.first %} in{% endif %}">
                <div class="accordion-inner">{% if forloop.first %}
                  <div id="topic_chart" style="height:270px;"></div>
                  <form action="#">
                    <div class="input-append text-center">
                      <select id="region-selector" class="span3">
                        <option value=""> -- Confronta con una regione -- </option>
                      </select><a id="region-reset" class="btn add-on" href="#">reset</a>

                      <select id="indicator-selector" class="span5"></select>
                    </div>
                  </form>
                {% endif %}</div>
              </div>
            </div>
          {% endfor %}
        </div>

      </div>
    </div>
  </section>
  {% endif %}

  <div class="container">
    <div class="row">
      <section class="span3">

        <h1 class='title'><span>Soggetti</span></h1>

        <p>
          I soggetti coinvolti nei progetti sono <strong>{{ numero_soggetti }}</strong> divisi tra programmatori, attuatori, realizzatori
          e destinatari.
          Di ogni soggetto vengono indicati tutti i progetti e i finanziamenti ricevuti.
        </p>

        <hr>

        <form class="form-search content">
          <h5>Cerca tra i soggetti</h5>
          <div class="input-append">
            <input type="text" class="input-medium search-query" placeholder="Inserisci una parola"><button type="submit" class="btn"><i class="icon-search"></i></button>
          </div>
        </form>

      </section>

      <section class="span3">
        <h1 class='title'><span>Progetti con più finanziamenti</span></h1>

        <table class="table">
          {% for progetto in top_progetti_per_costo %}
            <tr>
              <td><a href="{{ progetto.get_absolute_url }}">{{ progetto.titolo_progetto|title }}</a></td>
              <td class="amount"><strong>{{ progetto.fin_totale_pubblico|intcomma }}</strong> euro</td>
            </tr>
          {% endfor %}
        </table>
      </section>

      <section class="span3">
        <h1 class='title'><span>Ultimi progetti conclusi</span></h1>

        <ul class='spaced'>
          {% for progetto in ultimi_progetti_conclusi %}
            <li><a href="{{ progetto.get_absolute_url }}">{{ progetto.titolo_progetto }}</a></li>
          {% endfor %}
        </ul>

      </section>

      {% if territori_piu_finanziati_pro_capite %}
      <section class="span3">
        <h1 class='title'><span>I territori più finanziati (pro capite)</span></h1>

        <table class="table">
          {% for territorio_finanziato in territori_piu_finanziati_pro_capite %}
          <tr>
            <td><a href="{{ territorio_finanziato.get_absolute_url }}">{{ territorio_finanziato }}</a></td>
            <td class="amount"><strong>{{ territorio_finanziato.totale|intcomma }}</strong> euro</td>
          </tr>
          {% endfor %}
        </table>

      </section>
      {% endif %}

    </div>
  </div>


{% endblock %}